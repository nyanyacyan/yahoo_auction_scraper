# Yahoo Auction Scraper - 処理フロー設計（mm）

## 処理全体フロー

### 1
#### スプレッドシート読込
- 入力情報（検索キーワード1〜5、落札日、対象ワークシート名）をGoogleスプレッドシートから読み込む
- 対象のワークシートが存在しない場合は新規作成する

---

### 2
#### 各行に対してループ
- 取得したデータを行ごとに処理
- 各行を1セットと見なしてループ開始

---

### 3
#### 検索キーワード結合 → URL作成
- 検索ワード（複数）を結合し、URLエンコードして検索URLを生成
- 例：Yahoo!オークションの終了検索URLに対し、クエリを付与する形式

---

### 4
#### ページにアクセス（Selenium）
- 生成したURLにSeleniumでアクセス
- 終了済み商品ページが表示される

---

### 5
#### 商品リストの各商品についてループ
- 表示された商品一覧からすべての商品ブロックを取得
- 各ブロックについて順に処理を実施

---

### 6
#### 終了日取得 → 落札日より未来ならスキップ
- 商品の終了日を取得
- 指定された「落札日」より後であればスキップ
- 昇順ループのため、ここで打ち切り（以降の商品も除外）

---

### 7
#### 対象商品URLを取得 → 詳細ページへ遷移
- 処理対象となる商品の詳細ページURLを取得し遷移

---

### 8
#### タイトル・価格・画像取得
- 詳細ページから以下の情報を取得
  - 商品タイトル
  - 落札価格（例：¥51,700）
  - 画像（あれば1枚目のみ）

---

### 9
#### ct数値をタイトルから抽出
- タイトル中から「ct」の直前にある数値（例：0.508）を抽出

---

### 10
#### 単価計算：価格 ÷ ct → -10% × 2
- 単価 = 価格 ÷ ct
- そこからヤフオク手数料・税引きとして-10%を2回かける

---

### 11
#### データフレームに変換
- 取得・計算した情報を1レコードとしてDataFrameに整形

---

### 12
#### 書き込み先スプレッドシートを確認
- 指定されたワークシート名の存在を確認（必要なら作成済）

---

### 13
#### 空欄の位置を検出
- 対象ワークシートにおいて、次に書き込める行を検索
- 主にタイトル欄などの空欄チェックで実現

---

### 14
#### データをスプレッドシートに貼り付け
- 空欄に対しDataFrameから一括貼り付け
- 画像はサイズを調整し貼り付け対応（軽量化前提）

---

### 15
#### 次の行（検索セット）へループ
- スプシの次の行へ処理を進め、ステップ3〜14を繰り返す  
